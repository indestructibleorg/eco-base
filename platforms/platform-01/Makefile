# Makefile - é–‰ç’°ç³»çµ±ä¸€éµé©—æ”¶
# ä»»ä½•äººã€ä»»ä½•æ™‚é–“ã€ä»»ä½•é‡è·‘éƒ½èƒ½å¾—åˆ°åŒæ¨£çµè«–

.PHONY: verify verify-json verify-junit verify-continuous verify-all clean help \
    test-contract test-state test-crash test-idem test-verify test-audit test-e2e acceptance \
    verify-artifacts verify-manifest

# é»˜èªç›®æ¨™
.DEFAULT_GOAL := verify

# Python è§£é‡‹å™¨
PYTHON := python3
PIP := pip3

# è¼¸å‡ºç›®éŒ„
OUTPUT_DIR := verification_reports
ARTIFACTS_DIR := artifacts

# å®‰è£ä¾è³´
install:
	@echo "ğŸ“¦ å®‰è£ä¾è³´..."
	$(PIP) install -q jsonschema semver pytest pytest-asyncio 2>/dev/null || true
	@echo "âœ… ä¾è³´å®‰è£å®Œæˆ"

# ä¸€éµé©—æ”¶ - é»˜èªè¼¸å‡º Markdown æ ¼å¼
verify: install
	@echo ""
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘           é–‰ç’°ç³»çµ± 6 å±¤é©—è­‰çŸ©é™£ - ä¸€éµé©—æ”¶                    â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@mkdir -p $(OUTPUT_DIR)
	$(PYTHON) verify.py --output $(OUTPUT_DIR)/verify_report_$(shell date +%Y%m%d_%H%M%S).md
	@echo ""
	@echo "âœ… é©—è­‰å®Œæˆï¼Œå ±å‘Šä¿å­˜åœ¨ $(OUTPUT_DIR)/"

# JSON æ ¼å¼è¼¸å‡º
verify-json: install
	@mkdir -p $(OUTPUT_DIR)
	$(PYTHON) verify.py --output-format json --output $(OUTPUT_DIR)/verify_report_$(shell date +%Y%m%d_%H%M%S).json

# JUnit XML æ ¼å¼è¼¸å‡ºï¼ˆCI ä½¿ç”¨ï¼‰
verify-junit: install
	@mkdir -p $(OUTPUT_DIR)
	$(PYTHON) verify.py --output-format junit --output $(OUTPUT_DIR)/verify_report_$(shell date +%Y%m%d_%H%M%S).xml

# é€£çºŒè·‘ 3 æ¬¡é©—è­‰ï¼ˆæœ€çµ‚é©—æ”¶æ¨™æº–ï¼‰
verify-continuous: install
	@echo ""
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘        é€£çºŒ 3 æ¬¡é©—è­‰ï¼ˆæœ€çµ‚é©—æ”¶æ¨™æº–ï¼‰                          â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@mkdir -p $(OUTPUT_DIR)
	$(PYTHON) verify.py --continuous 3 --output $(OUTPUT_DIR)/verify_continuous_$(shell date +%Y%m%d_%H%M%S).md
	@echo ""
	@echo "âœ… é€£çºŒé©—è­‰å®Œæˆ"

# å®Œæ•´é©—è­‰ï¼ˆæ‰€æœ‰å±¤ï¼‰
verify-all: install
	@echo ""
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘              å®Œæ•´ 6 å±¤é©—è­‰                                    â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@mkdir -p $(OUTPUT_DIR)
	$(PYTHON) verify.py --output $(OUTPUT_DIR)/verify_all_$(shell date +%Y%m%d_%H%M%S).md

# å–®å±¤é©—è­‰
verify-layer-1: install
	@echo "ğŸ” åŸ·è¡Œç¬¬ 1 å±¤é©—è­‰ï¼šåˆç´„ï¼ˆContractï¼‰é©—è­‰"
	$(PYTHON) verify.py --layer 1

verify-layer-2: install
	@echo "ğŸ” åŸ·è¡Œç¬¬ 2 å±¤é©—è­‰ï¼šç‹€æ…‹æ©Ÿï¼ˆState Machineï¼‰é©—è­‰"
	$(PYTHON) verify.py --layer 2

verify-layer-3: install
	@echo "ğŸ” åŸ·è¡Œç¬¬ 3 å±¤é©—è­‰ï¼šå¹‚ç­‰ï¼ˆIdempotencyï¼‰é©—è­‰"
	$(PYTHON) verify.py --layer 3

verify-layer-4: install
	@echo "ğŸ” åŸ·è¡Œç¬¬ 4 å±¤é©—è­‰ï¼šCrash-Resume é©—è­‰"
	$(PYTHON) verify.py --layer 4

verify-layer-5: install
	@echo "ğŸ” åŸ·è¡Œç¬¬ 5 å±¤é©—è­‰ï¼šVerification Gate é©—è­‰"
	$(PYTHON) verify.py --layer 5

verify-layer-6: install
	@echo "ğŸ” åŸ·è¡Œç¬¬ 6 å±¤é©—è­‰ï¼šç¨½æ ¸/å¯é‡æ’­ï¼ˆAudit/Reproducibilityï¼‰é©—è­‰"
	$(PYTHON) verify.py --layer 6

# ============================================================================
# Closed-Loop Acceptance Kit - é©—æ”¶æ¸¬è©¦ç›®æ¨™
# ============================================================================

# å¥‘ç´„é©—è­‰ - é©—è­‰ JSON Schema å’Œç”¢ç‰©å®Œæ•´æ€§
test-contract: install
	@echo ""
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘              å¥‘ç´„é©—è­‰ (Contract Validation)                   â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	$(PYTHON) scripts/validate_contracts.py \
		--schemas-dir schemas/ \
		--artifacts-glob "artifacts/*.json" \
		--fail-on-missing
	@echo "âœ… å¥‘ç´„é©—è­‰é€šé"

# é©—è­‰ç”¢ç‰©å®Œæ•´æ€§
verify-artifacts: install
	@echo "ğŸ” é©—è­‰ç”¢ç‰©å®Œæ•´æ€§..."
	$(PYTHON) scripts/verify_artifacts_required.py \
		--artifacts-dir artifacts/ \
		--strict
	@echo "âœ… ç”¢ç‰©å®Œæ•´æ€§é©—è­‰é€šé"

# é©—è­‰ manifest hash
verify-manifest: install
	@echo "ğŸ” é©—è­‰ manifest hash..."
	$(PYTHON) scripts/verify_manifest.py \
		--manifest artifacts/manifest.json \
		--verify
	@echo "âœ… Manifest hash é©—è­‰é€šé"

# ç‹€æ…‹æ©Ÿæ¸¬è©¦
test-state: install
	@echo ""
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘            ç‹€æ…‹æ©Ÿæ¸¬è©¦ (State Machine Test)                    â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	pytest tests/test_state_machine.py -v --tb=short
	@echo "âœ… ç‹€æ…‹æ©Ÿæ¸¬è©¦é€šé"

# Crash-Resume E2E æ¸¬è©¦
test-crash: install
	@echo ""
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘         Crash-Resume E2E æ¸¬è©¦                                 â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	pytest tests/e2e/test_crash_resume_e2e.py -v --tb=short
	@echo "âœ… Crash-Resume æ¸¬è©¦é€šé"

# å¹‚ç­‰æ€§ E2E æ¸¬è©¦
test-idem: install
	@echo ""
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘           å¹‚ç­‰æ€§ E2E æ¸¬è©¦ (Idempotency Test)                  â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	pytest tests/e2e/test_idempotency_e2e.py -v --tb=short
	@echo "âœ… å¹‚ç­‰æ€§æ¸¬è©¦é€šé"

# Verify-Fail E2E æ¸¬è©¦
test-verify: install
	@echo ""
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘         Verify-Fail E2E æ¸¬è©¦                                  â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	pytest tests/e2e/test_verify_fail_e2e.py -v --tb=short
	@echo "âœ… Verify-Fail æ¸¬è©¦é€šé"

# Audit E2E æ¸¬è©¦
test-audit: install
	@echo ""
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘           Audit E2E æ¸¬è©¦                                      â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	pytest tests/e2e/test_audit_e2e.py -v --tb=short
	@echo "âœ… Audit æ¸¬è©¦é€šé"

# æ‰€æœ‰ E2E æ¸¬è©¦
test-e2e: test-crash test-idem test-verify test-audit
	@echo ""
	@echo "âœ… æ‰€æœ‰ E2E æ¸¬è©¦é€šé"

# å–®å…ƒæ¸¬è©¦ï¼ˆscripts é©—è­‰ï¼‰
test-unit: install
	@echo ""
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘           å–®å…ƒæ¸¬è©¦ (Unit Tests)                               â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	pytest tests/test_scripts_contracts_and_audit.py -v --tb=short
	@echo "âœ… å–®å…ƒæ¸¬è©¦é€šé"

# å®Œæ•´é©—æ”¶å¥—ä»¶ - 6 å±¤å…¨éƒ¨é©—è­‰
acceptance: install
	@echo ""
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘                                                              â•‘"
	@echo "â•‘        Closed-Loop Acceptance Kit - å®Œæ•´é©—æ”¶å¥—ä»¶              â•‘"
	@echo "â•‘                                                              â•‘"
	@echo "â•‘     ä»»ä½•äººã€ä»»ä½•æ™‚é–“ã€ä»»ä½•é‡è·‘éƒ½èƒ½å¾—åˆ°åŒæ¨£çµè«–ï¼š              â•‘"
	@echo "â•‘        ä¸ä¸­æ–·ã€å¯çºŒè·‘ã€å¯å›æ»¾ã€å¯ç¨½æ ¸                         â•‘"
	@echo "â•‘                                                              â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo "Layer 1: å¥‘ç´„é©—è­‰ (Contract)"
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	$(MAKE) test-contract
	@echo ""
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo "Layer 2: ç‹€æ…‹æ©Ÿæ¸¬è©¦ (State Machine)"
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	$(MAKE) test-state
	@echo ""
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo "Layer 3: Crash-Resume E2E"
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	$(MAKE) test-crash
	@echo ""
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo "Layer 4: å¹‚ç­‰æ€§ E2E (Idempotency)"
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	$(MAKE) test-idem
	@echo ""
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo "Layer 5: Verify-Fail E2E"
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	$(MAKE) test-verify
	@echo ""
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo "Layer 6: Audit E2E"
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	$(MAKE) test-audit
	@echo ""
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo "ç”¢ç‰©å®Œæ•´æ€§é©—è­‰"
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	$(MAKE) verify-artifacts
	$(MAKE) verify-manifest
	@echo ""
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘                                                              â•‘"
	@echo "â•‘              âœ… å®Œæ•´é©—æ”¶é€šé (ALL ACCEPTANCE PASSED)          â•‘"
	@echo "â•‘                                                              â•‘"
	@echo "â•‘     ç³»çµ±æ»¿è¶³ä»¥ä¸‹ä¸è®Šé‡ï¼š                                      â•‘"
	@echo "â•‘     â€¢ ä¸ä¸­æ–· (Crash-Resume): ä»»æ„ä¸­æ–·éƒ½èƒ½çºŒè·‘                 â•‘"
	@echo "â•‘     â€¢ å¯çºŒè·‘ (Idempotency): é‡æ”¾ä¸ç”¢ç”Ÿå‰¯ä½œç”¨                  â•‘"
	@echo "â•‘     â€¢ å¯å›æ»¾ (Verify-Fail): é©—è­‰å¤±æ•—å¿…å›æ»¾                    â•‘"
	@echo "â•‘     â€¢ å¯ç¨½æ ¸ (Audit): hash ä¸€è‡´ã€è­‰æ“šé½Šå…¨                     â•‘"
	@echo "â•‘                                                              â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

# Schema é©—è­‰ï¼ˆCI å¿…è·‘ï¼‰
verify-schema:
	@echo "ğŸ” é©—è­‰ JSON Schema..."
	$(PYTHON) -c "import json, jsonschema; \
		schemas = ['contracts/decision.schema.json', 'contracts/action.schema.json', 'contracts/run.schema.json']; \
		[jsonschema.Draft7Validator.check_schema(json.load(open(s))) for s in schemas]; \
		print('âœ… All schemas valid')"

# ç‰ˆæœ¬è™Ÿé©—è­‰ï¼ˆCI å¿…è·‘ï¼‰
verify-versions:
	@echo "ğŸ” é©—è­‰ç‰ˆæœ¬è™Ÿ semver æ ¼å¼..."
	$(PYTHON) -c "import json, semver; \
		schemas = ['contracts/decision.schema.json', 'contracts/action.schema.json', 'contracts/run.schema.json']; \
		[semver.VersionInfo.parse(json.load(open(s))['version']) for s in schemas]; \
		print('âœ… All versions valid semver')"

# æ¸…ç†
 clean:
	@echo "ğŸ§¹ æ¸…ç†..."
	rm -rf $(OUTPUT_DIR)
	rm -rf $(ARTIFACTS_DIR)
	rm -rf .pytest_cache
	find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
	@echo "âœ… æ¸…ç†å®Œæˆ"

# å¹«åŠ©
help:
	@echo ""
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘           é–‰ç’°ç³»çµ±ä¸€éµé©—æ”¶ - å¯ç”¨å‘½ä»¤                         â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@echo "ä¸€éµé©—æ”¶:"
	@echo "  make verify              - åŸ·è¡Œå®Œæ•´é©—è­‰ï¼ˆé»˜èª Markdown æ ¼å¼ï¼‰"
	@echo "  make verify-json         - JSON æ ¼å¼è¼¸å‡º"
	@echo "  make verify-junit        - JUnit XML æ ¼å¼è¼¸å‡ºï¼ˆCI ä½¿ç”¨ï¼‰"
	@echo "  make verify-continuous   - é€£çºŒè·‘ 3 æ¬¡ï¼ˆæœ€çµ‚é©—æ”¶æ¨™æº–ï¼‰"
	@echo ""
	@echo "å–®å±¤é©—è­‰:"
	@echo "  make verify-layer-1      - ç¬¬ 1 å±¤ï¼šåˆç´„é©—è­‰"
	@echo "  make verify-layer-2      - ç¬¬ 2 å±¤ï¼šç‹€æ…‹æ©Ÿé©—è­‰"
	@echo "  make verify-layer-3      - ç¬¬ 3 å±¤ï¼šå¹‚ç­‰é©—è­‰"
	@echo "  make verify-layer-4      - ç¬¬ 4 å±¤ï¼šCrash-Resume é©—è­‰"
	@echo "  make verify-layer-5      - ç¬¬ 5 å±¤ï¼šVerification Gate é©—è­‰"
	@echo "  make verify-layer-6      - ç¬¬ 6 å±¤ï¼šç¨½æ ¸é©—è­‰"
	@echo ""
	@echo "CI é©—è­‰:"
	@echo "  make verify-schema       - Schema æœ‰æ•ˆæ€§é©—è­‰"
	@echo "  make verify-versions     - ç‰ˆæœ¬è™Ÿ semver é©—è­‰"
	@echo "  make verify-artifacts    - ç”¢ç‰©å®Œæ•´æ€§é©—è­‰"
	@echo "  make verify-manifest     - Manifest hash é©—è­‰"
	@echo ""
	@echo "é©—æ”¶æ¸¬è©¦å¥—ä»¶ (Acceptance Kit):"
	@echo "  make acceptance          - å®Œæ•´ 6 å±¤é©—æ”¶å¥—ä»¶"
	@echo "  make test-unit           - å–®å…ƒæ¸¬è©¦ï¼ˆscripts é©—è­‰ï¼‰"
	@echo "  make test-contract       - å¥‘ç´„é©—è­‰ (Layer 1)"
	@echo "  make test-state          - ç‹€æ…‹æ©Ÿæ¸¬è©¦ (Layer 2)"
	@echo "  make test-crash          - Crash-Resume E2E (Layer 3)"
	@echo "  make test-idem           - å¹‚ç­‰æ€§ E2E (Layer 4)"
	@echo "  make test-verify         - Verify-Fail E2E (Layer 5)"
	@echo "  make test-audit          - Audit E2E (Layer 6)"
	@echo "  make test-e2e            - æ‰€æœ‰ E2E æ¸¬è©¦"
	@echo ""
	@echo "å…¶ä»–:"
	@echo "  make install             - å®‰è£ä¾è³´"
	@echo "  make clean               - æ¸…ç†è‡¨æ™‚æ–‡ä»¶"
	@echo "  make help                - é¡¯ç¤ºæ­¤å¹«åŠ©"
	@echo ""
	@echo "é©—è­‰å±¤èªªæ˜:"
	@echo "  Layer 1: åˆç´„ï¼ˆContractï¼‰é©—è­‰ - Schema + ç‰ˆæœ¬é–"
	@echo "  Layer 2: ç‹€æ…‹æ©Ÿï¼ˆState Machineï¼‰é©—è­‰ - è½‰ç§»è¡¨ + æ€§è³ªæ¸¬è©¦"
	@echo "  Layer 3: å¹‚ç­‰ï¼ˆIdempotencyï¼‰é©—è­‰ - é‡æ”¾ä¸ç”¢ç”Ÿå‰¯ä½œç”¨"
	@echo "  Layer 4: Crash-Resume é©—è­‰ - ä»»æ„ä¸­æ–·éƒ½èƒ½çºŒè·‘"
	@echo "  Layer 5: Verification Gate é©—è­‰ - é©—è­‰å¤±æ•—å¿…å›æ»¾/å‡ç´š"
	@echo "  Layer 6: ç¨½æ ¸/å¯é‡æ’­ï¼ˆAudit/Reproducibilityï¼‰é©—è­‰ - hash ä¸€è‡´ã€è­‰æ“šé½Šå…¨"
	@echo ""
